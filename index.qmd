---
title: "Exam-01"
author: "Pablo Vivas"
date: "`r Sys.Date()`"
format:
  html:
    toc: true
    toc-location: left
    toc-depth: 2
    code-copy: true
    code-fold: true
    highlight-style: nord
  docx: default
execute:
  warning: false
  error: false
  echo: true
# bibliography: "assets/assignment-04.bib"
# csl: "assets/apa.csl"
theme: simplex
---

```{r}
#| label: set-up
#| echo: false

library(broom)
library(cowplot)
library(gt)
library(skimr)
library(tidyverse)
```

# Question 1

## Pre-work

First, we read the data and take a look at how does it look.

```{r}
#| label: tbl-read-data
#| tbl-cap: Sample of (n=10) observations of the World data 

world = read_csv("data/world-3.csv")

world |> 
  sample_n(10) |> 
  arrange(country) |> 
  gt() |> 
  fmt_number(
    columns = c(6, 10, 11, 12),
    decimals = 2
  )
```

Then, we make a description of all the numeric values.

```{r}
#| label: tbl-desc-data
#| tbl-cap: Summary of numeric variables for the World data 

world |> 
  select(where(is.numeric)) |> 
  skim() |> 
  select(-1) |> 
  gt() |> 
  fmt_number(
    columns = 3:10,
    decimals = 2
  ) |> 
  cols_label(
    skim_variable = "variable",
    n_missing = "missing",
    numeric.mean = "mean",
    numeric.sd = "std",
    numeric.p0 = "p0",
    numeric.p25 = "p25",
    numeric.p50 = "p50",
    numeric.p75 = "p75",
    numeric.p100 = "p100",
    numeric.hist = "histogram"
  ) |> 
  cols_align(
    columns = -1,
    align = "center"
  )
```

We see from @tbl-desc-data that some of the variables have missing data, specifically, the `literacym` variable has complete rate of 78%. Also, the standard deviation from each variable is in a different scale, ranging from 0.62 units in `gdp` to 38.08 units in `babymort`. This makes sense because some variables are in a log-scale.

::: {.callout-note}
Given this scenario, we would prefer to perform pca with the correlation matrix.
:::

## Real work

### a)

We perform two principal component analysis using: a) the covariance matrix and b) the correlation matrix.

```{r}
#| label: pca-perform

# get complete cases
world_complete = world |> 
  drop_na()

# for the covariance matrix
pca_cov = world_complete |> 
  select(-c(1,2)) |> 
  prcomp()

# for the correlation matrix
pca_cor = world_complete |> 
  select(-c(1,2)) |> 
  prcomp(scale = TRUE)

# matrix with loadings
loadings = bind_rows(
  pca_cov |> 
  tidy(matrix = "rotation") |> 
  mutate(matrix = factor("covariance")),
  pca_cor |> 
  tidy(matrix = "rotation") |> 
  mutate(matrix = factor("correlation"))
)
```

We plot the differences for the first two pcs using each method.

```{r}
loadings |> 
  filter(PC == 1) |> 
  ggplot() |> 
  geom_point(aes())
```


### b)

### c)

### d)

```{r}
#| label: fig-pca-01
world_complete = pca_cor |>
  augment(world_complete)
```

# Question 2

# Question 3